
@{
    ViewBag.Title = "Task8";
}
<div id="imgForm">
    <input onchange="readURL(this);" type="file" id="fileInput" />
    <img id="changeImage" />
    <button type="button" onclick="predictImage()" id="btnSubmit" class="btn btn-primary">Check Concept</button>
    <script type="text/javascript" src="https://sdk.clarifai.com/js/clarifai-latest.js"></script>
    <h3 id="receipt">It is a receipt!</h3>
</div>
<table id="styleTable" class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>Concept</th>
            <th>Value</th>
        </tr>
    </thead>
    <tbody class="concept"></tbody>
</table>
<style>
    #changeImage {
        height: 30%;
        width: 30%;
    }

    #myCanvas {
        visibility: hidden;
    }

    #imgForm {
        margin-top: 20px;
    }

    #styleTable {
        margin-top: 20px;
    }

    #receipt {
        visibility: hidden;
    }
</style>
<script>
    //Displaying picture
    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#changeImage')
                    .attr('src', e.target.result);
            };

            reader.readAsDataURL(input.files[0]);
        }
    }

    function predictImage() {
        const app = new Clarifai.App({
            apiKey: '*'
        });
        var file = $('#fileInput')[0].files[0];
        var reader = new FileReader();
        let num;
        let checker = 0;
        reader.readAsDataURL(file);
        reader.onloadend = function () {
            let str = reader.result.toString();
            num = str.substring(str.indexOf(",") + 1);
            app.inputs.create({
                base64: num
            }).then(
                function (response) {
                    console.log(response);
                    alert("Input Successful!" + response1[0].imageUrl)
                },
                function (err) {
                    console.log(err);
                    // there was an error
                }
            );
            app.models.predict(Clarifai.GENERAL_MODEL, { base64: num })
                .then(response => {
                    document.getElementById('receipt').style.visibility = "hidden";
                    $('.concept').html('');
                    let record = response.outputs[0].data.concepts;
                    for (let x = 0; x < record.length; x++) {
                        let rec = record[x];
                        let element = `<tr class="animate__animated animate__pulse"><td>${rec.name}</td><td>${rec.value}</td></tr>`;
                        if (rec.name == "paper" || rec.name == "writing" || rec.name == "business") {
                            checker++;
                            console.log(checker);
                            if (checker == 3) {
                                document.getElementById('receipt').style.visibility = "visible";
                            }
                        }
                        $('.concept').append(element);
                    }
                })
                .catch(err => {
                    console.log(err);
                });
        }
    }
</script>